# 第8章 文件与文件系统的压缩

## 1.Linux中的压缩文件常见扩展名

*.Z         compress 程序压缩的文件；
*.gz        gzip 程序压缩的文件；
*.bz2       bzip2 程序压缩的文件；
*.tar       tar 程序打包的数据，并没有压缩过；
*.tar.gz    tar 程序打包的文件，其中并且经过 gzip 的压缩；
*.tar.bz2   tar 程序打包的文件，其中并且经过 bzip2 的压缩；

## 2.gzip(应用度最广的压缩命令）

```
[root@www ~]# gzip [-cdtv#] 档名 
[root@www ~]# zcat 档名.gz 
选项与参数：
-c  ：将压缩的数据输出到萤幕上，可透过数据流重导向来处理；
-d  ：解压缩的参数；
-t  ：可以用来检验一个压缩档的一致性～看看文件有无错误； 
-v  ：可以显示出原文件/压缩文件的压缩比等资讯；
-#  ：压缩等级，-1 最快，但是压缩比最差、-9 最慢，但是压缩比最好！默认是 -6 

范例一：将 /etc/man.config 复制到 /tmp ，并且以 gzip 压缩 [root@www ~]# cd /tmp  
[root@www tmp]# cp /etc/man.config . 
[root@www tmp]# gzip -v man.config 
man.config:      56.1% -- replaced with man.config.gz [root@www tmp]# ll /etc/man.config /tmp/man*
-rw-r--r-- 1 root root 4617 Jan  6  2007 /etc/man.config 
-rw-r--r-- 1 root root 2684 Nov 10 17:24 /tmp/man.config.back.Z 
-rw-r--r-- 1 root root 2057 Nov 10 17:14 /tmp/man.config.gz  <==gzip压缩比较佳
```

## 3.完整备份工具：dump

dump的选项：

```
[root@www ~]# dump [-Suvj] [-level] [-f 备份档] 待备份数据 [root@www ~]# dump -W 
选项与参数：
-S    ：仅列出后面的待备份数据需要多少磁碟空间才能够备份完毕；
-u    ：将这次 dump 的时间记录到 /etc/dumpdates 文件中；
-v    ：将 dump 的文件过程显示出来；
-j    ：加入 bzip2 的支持！将数据进行压缩，默认 bzip2 压缩等级为 2 -level：就是我们谈到的等级，从 -0 ~ -9 共十个等级；
-f    ：有点类似 tar 啦！后面接产生的文件，亦可接例如 /dev/st0 装置档名等 
-W    ：列出在 /etc/fstab 里面的具有 dump 配置的 partition 是否有备份过？
```

## 4.用 dump 备份完整的文件系统

```
# 1. 先找出系统中最小的那个文件系统，如下所示： 
[root@www ~]# df -h 
Filesystem            Size  Used Avail Use% Mounted on /dev/hdc2             9.5G  3.7G  5.3G  42% / 
/dev/hdc3             4.8G  651M  3.9G  15% /home 
/dev/hdc1              99M   11M   83M  12% /boot
tmpfs                 363M     0  363M   0% /dev/shm 
# 2. 先测试一下，如果要备份此文件系统，需多少容量 
[root@www ~]# dump -S /dev/hdc1 
5630976     <==注意一下，这个单位是 bytes ，所以差不多是5.6MBytes # 3. 将完整备份的档名记录成为 /root/boot.dump ，同时升级记录档： [root@www ~]# dump -0u -f /root/boot.dump /boot  
DUMP: Date of this level 0 dump: Tue Dec  2 02:53:45 2008 <==记录等级与备份时间  
DUMP: Dumping /dev/hdc1 (/boot) to /root/boot.dump        <==dump的来源与目标 
DUMP: Label: /boot                  <==文件系统的 label 
DUMP: Writing 10 Kilobyte records  
DUMP: mapping (Pass I) [regular files]     <==开始进行文件对应
DUMP: mapping (Pass II) [directories]  
DUMP: estimated 5499 blocks.            <==评估整体block数量 
DUMP: Volume 1 started with block 1 at: Tue Dec  2 02:53:46 2008  
DUMP: dumping (Pass III) [directories]    <==开始 dump 工作
DUMP: dumping (Pass IV) [regular files]
DUMP: Closing /root/boot.dump             <==结束写入备份档 
DUMP: Volume 1 completed at: Tue Dec  2 02:53:47 2008  
DUMP: Volume 1 5550 blocks (5.42MB)       <==最终备份数据容量  DUMP: Volume 1 took 0:00:01 
DUMP: Volume 1 transfer rate: 5550 kB/s  
DUMP: 5550 blocks (5.42MB) on 1 volume(s)  
DUMP: finished in 1 seconds, throughput 5550 kBytes/sec  DUMP: Date of this level 0 dump: Tue Dec  2 02:53:45 2008  DUMP: Date this dump completed:  Tue Dec  2 02:53:47 2008  DUMP: Average transfer rate: 5550 kB/s  DUMP: DUMP IS DONE
[root@www ~]# ll /root/boot.dump /etc/dumpdates -rw-rw-r-- 1 root disk      43 Dec  2 02:53 /etc/dumpdates -rw-r--r-- 1 root root 5683200 Dec  2 02:53 /root/boot.dump 
# 4. 观察一下系统主动创建的记录档： 
[root@www ~]# cat /etc/dumpdates
/dev/hdc1     0   Tue Dec  2 02:53:47 2008 +0800 
[文件系统] [等级] [       ctime 的时间         ]
```